import { faker } from '@faker-js/faker';
import { Key } from "webdriverio";

describe("application_creation_v2", () => {
  it("tests application_creation_v2", async () => {
    await browser.url("https://kooyonggroup--kguat2.sandbox.my.salesforce.com/")
    await browser.$("#username").setValue("niladri.acharya@cloudkaptan.com.kguat2.ra")
    await browser.$("#password").setValue("welcome@123")
    await browser.$("#Login").click()
    await (await browser.$("//a[@title='Leads']")).waitForExist({ timeout: 15000 });

    await browser.execute(async (el) => {
      await el.click();
    }, await browser.$("//a[@title='Leads']"));
    await (await browser.$("//a/div[@title='New']")).click();

    await (await browser.$("//label[contains(text(), 'Salutation')]/following-sibling::div")).waitForExist();
    await browser.$("//label[contains(text(), 'Salutation')]/following-sibling::div").click()
    await browser.$("//span[@title='Mr.']/ancestor::lightning-base-combobox-item").click()

    const firstName = faker.person.firstName();
    const lastName = faker.person.lastName();
    const email = faker.internet.email();

    await browser.$("//input[@name='firstName']").setValue(firstName);
    await browser.$("//input[@name='lastName']").setValue(lastName);
    await browser.execute(async (el) => {
      await el.click();
    }, await browser.$("//button[contains(@aria-label, 'Gender')]"));
    await browser.$("//span[@title='Female']/ancestor::lightning-base-combobox-item").click()

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//button[@aria-label='Borrowing Interest, --None--']"));
    await browser.$("//button[@aria-label='Borrowing Interest, --None--']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.$("//input[@name='MobilePhone']").setValue("478456345")
    await browser.$("//input[@name='Email']").setValue(email)

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//input[@aria-label='State/Province']"));
    await browser.$("//input[@aria-label='State/Province']").click()
    await browser.$("//span[@title='New South Wales']/ancestor::lightning-base-combobox-item").click()

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//button[@aria-label='Lead Origination, --None--']"));
    await browser.$("//button[@aria-label='Lead Origination, --None--']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//button[@aria-label='Lead Category, --None--']"));
    await browser.$("//button[@aria-label='Lead Category, --None--']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//button[@aria-label='Employment Status, --None--']"));
    await browser.$("//button[@aria-label='Employment Status, --None--']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//button[@aria-label='Profession, --None--']"));
    await browser.$("//button[@aria-label='Profession, --None--']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.$("//input[@name='Aphra_Number__c']").setValue("abc1234");
    await browser.$("//label[contains(text(), 'Pardot Comments')]/following-sibling::div/textarea").setValue("No Comments");
    await browser.$("//button[@name='SaveEdit']").click();

    await browser.$(`//lightning-formatted-name[contains(text(), '${firstName} ${lastName}')]`).waitForExist({timeout: 20000});

    await browser.$("//li[@data-name='converted']").waitForExist({timeout: 10000});
    await browser.execute(async (el) => {
      await el.click();
    }, await browser.$("//li[@data-name='converted']"));
    await browser.execute(async (el) => {
      await el.click();
    }, await browser.$("//span[contains(text(), 'Select Converted Status')]"));

    await browser.$("//h2[contains(text(), 'Convert Lead ')]").waitForExist({timeout: 10000});
    await browser.pause(2000);
    await browser.$("//button[contains(text(), 'Convert')]").click();
    await browser.$(`//a[contains(text(), '${firstName} ${lastName}')]`).waitForExist({timeout: 40000});
    await browser.$(`//a[contains(text(), '${firstName} ${lastName}')]`).click();
    await browser.$(`//lightning-formatted-name[contains(text(), '${firstName} ${lastName}')]`).waitForExist({timeout: 20000});

    await browser.pause(2000);
    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//button[@title='Edit Birthdate']"));
    await browser.execute(async (el) => {
      await el.click();
    }, await browser.$("//button[@title='Edit Birthdate']"));
    await browser.$("//button[text()='Save']").waitForExist({ timeout: 20000 });
    await browser.$("//input[@name='PersonBirthdate']").setValue('01/01/2000');

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//button[@aria-label='Age Range, --None--']"));
    await browser.$("//button[@aria-label='Age Range, --None--']").click();
    await browser.pause(1000);
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.$("//button[text()='Save']").click();
    await browser.pause('5000');

    await browser.execute(async (el) => {
      await el.click();
    }, await browser.$("//a[@title='Opportunities']"));
    browser.pause(4000);

    await browser.$(`//a[text() = '${firstName} ${lastName}-']`).click();
    await browser.pause(2000);

    await browser.refresh();

    await browser.pause(2000);
    await browser.execute(async (el) => {
      await el.click();
    }, await browser.$("//a[contains(text(), 'Details')]"));
    await browser.$("//span[contains(text(), 'Please make sure the mandatory fields are filled up')]").waitForExist({ timeout: 20000 });

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//button[@title='Edit Loan Type']"));
    await browser.execute(async (el) => {
      await el.click();
    }, await browser.$("//button[@title='Edit Loan Type']"));
    await browser.$("//button[text()='Save']").waitForExist({ timeout: 20000 });

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//label[contains(text(), 'Relationship Associate')]"));
    await browser.$("//label[contains(text(), 'Relationship Associate')]/following-sibling::div/div").click();
    await browser.pause(1000);
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.$("//button[@aria-label='Loan Type, --None--']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//button[@aria-label='Loan Type, Residential']"));
    await browser.$("//button[@aria-label='Loan Type, Residential']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.$("//button[@aria-label='Asset Type, --None--']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.$("//input[@name='Amount']").setValue("100000");
    await browser.$("//input[@name='Term__c']").setValue("36");

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//button[@aria-label='Client Type, --None--']"));
    await browser.$("//button[@aria-label='Client Type, --None--']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.$("//button[@aria-label='Transaction Type, --None--']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.$("//button[@aria-label='Loan Use, --None--']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.execute("arguments[0].scrollIntoView({ block: 'center', inline: 'nearest' })", await browser.$("//button[@aria-label='Lender, --None--']"));
    await browser.$("//button[@aria-label='Lender, --None--']").click()
    await browser.keys([Key.ArrowDown]);
    await browser.keys([Key.Enter]);

    await browser.$("//button[text()='Save']").click();

    await browser.$("//li[@data-name='Preparing application']").waitForExist({ timeout: 10000 });
    await browser.execute(async (el) => {
      await el.click();
    }, await browser.$("//li[@data-name='Preparing application']"));

    await browser.execute(async (el) => {
      await el.click();
    }, await browser.$("//span[text() = 'Mark as Current Stage']/parent::button"));
    await browser.pause(2000);
    await browser.$("//button[text() = 'Create Application']//ancestor::li").click();


    
    await browser.$("//li[@data-name='Preparing application']//span[@class='complete slds-path__stage']").waitForExist({timeout: 15000});

    await browser.$("//*[@id=\"content_49:3044;a\"]/div/div[2]/div/div[1]/div/div/div/div[2]/div[2]/a").click()
    await browser.$("//*[@id=\"sectionContent-1309\"]/div/slot/records-record-layout-row[3]/slot/records-record-layout-item[2]/div/div/div[2]/button").click()
    await browser.$("#combobox-button-1609").click()
    await browser.$("#combobox-button-1609-1-1609").click()
    await browser.$("#input-1568").click()
    await browser.$("#select-1744").click()
    await browser.$("#select-1744").setValue("1996")
    await browser.$("//*[@id=\"sectionContent-1296\"]/div/slot/records-record-layout-row[1]/slot/records-record-layout-item[1]/div/span/slot/lightning-input/lightning-datepicker/div[1]/div/lightning-calendar/div/lightning-focus-trap/slot/table/tbody/tr[2]/td[4]/span").click()
    await browser.$("//*[@id=\"combobox-button-1589\"]/span").click()
    await browser.$("//*[@id=\"combobox-button-1589-2-1589\"]/span[2]/span").click()
    await browser.$("//*[@id=\"tab-23\"]/slot/flexipage-component2/slot/records-lwc-detail-panel/records-base-record-form/div/div/div/records-form-footer/div/div/div/runtime_platform_actions-actions-ribbon/ul/li[2]/runtime_platform_actions-action-renderer/runtime_platform_actions-executor-lwc-headless/slot[1]/slot/lightning-button/button").click()
    await browser.$("/html/body/div[4]/div[1]/section/div[1]/div[1]/one-appnav/div/one-app-nav-bar/nav/div/one-app-nav-bar-item-root[5]/a/span").click()
    await browser.$("//*[@id=\"brandBand_1\"]/div/div/div/div/div[2]/div/div[1]/div[2]/div[2]/div[1]/div/div/table/tbody/tr[1]/th/span/a").click()
    await browser.$("//*[@id=\"5448:0\"]/div[1]/div[1]/div[1]/div/div/ul/li[3]/a").click()
    await browser.$("//*[@id=\"detailTab__item\"]").click()
    await browser.$("//*[@id=\"sectionContent-2082\"]/div/slot/records-record-layout-row[1]/slot/records-record-layout-item[1]/div/div/div[2]/button").click()
    await browser.$("//*[@id=\"sectionContent-2247\"]/div/slot/records-record-layout-row[1]/slot/records-record-layout-item[1]/div/span/slot/records-record-picklist/records-form-picklist/lightning-picklist/lightning-combobox").click()
    await browser.$("#combobox-button-2568").click()
    await browser.$("//*[@id=\"combobox-button-2568-5-2568\"]/span[2]/span").click()
    await browser.$("#combobox-button-2578").click()
    await browser.$("//*[@id=\"combobox-button-2578-1-2578\"]/span[2]/span").click()
    await browser.$("#combobox-button-2587").click()
    await browser.$("//*[@id=\"combobox-button-2587-1-2587\"]/span[2]").click()
    await browser.$("#input-2573").click()
    await browser.$("#input-2573").setValue("100000")
    await browser.$("#input-2582").click()
    await browser.$("#input-2582").setValue("12")
    await browser.$("#combobox-button-2617").click()
    await browser.$("//*[@id=\"combobox-button-2617-1-2617\"]/span[2]").click()
    await browser.$("#combobox-button-2596").click()
    await browser.$("//*[@id=\"combobox-button-2596-2-2596\"]/span[2]/span").click()
    await browser.$("#combobox-button-2603").click()
    await browser.$("//*[@id=\"combobox-button-2603-2-2603\"]/span[2]/span").click()
    await browser.$("#combobox-button-2643").click()
    await browser.$("//*[@id=\"combobox-button-2643-2-2643\"]/span[2]").click()
    await browser.$("#combobox-input-2722").click()
    await browser.$("#combobox-input-2722").setValue("nil")
    await browser.$("//*[@id=\"combobox-input-2722-1-2722\"]/span[2]/span").click()
    await browser.$("//*[@id=\"tab-42\"]/slot/flexipage-component2/slot/records-lwc-detail-panel/records-base-record-form/div/div/div/records-form-footer/div/div/div/runtime_platform_actions-actions-ribbon/ul/li[2]/runtime_platform_actions-action-renderer/runtime_platform_actions-executor-lwc-headless/slot[1]/slot/lightning-button/button").click()
    await browser.$("//*[@id=\"5448:0\"]/div[1]/div[2]/button/span").click()
    await browser.$("//*[@id=\"brandBand_2\"]/div/div/div[5]/div/one-record-home-flexipage2/forcegenerated-adg-rollup_component___force-generated__flexipage_-record-page___-opportunity_-record_-page___-opportunity___-v-i-e-w/forcegenerated-flexipage_opportunity_record_page_opportunity__view_js/record_flexipage-desktop-record-page-decorator/div[1]/records-record-layout-event-broker/slot/slot/flexipage-record-home-with-subheader-template-desktop2/div/div[1]/slot/flexipage-component2/slot/records-lwc-highlights-panel/records-lwc-record-layout/forcegenerated-highlightspanel_opportunity___012000000000000aaa___compact___view___recordlayout2/records-highlights2/div[1]/div[1]/div[3]/div/runtime_platform_actions-actions-ribbon/ul/li[3]/runtime_platform_actions-action-renderer/runtime_platform_actions-executor-lightning-component/slot/slot/lightning-button/button").click()
  });
});
